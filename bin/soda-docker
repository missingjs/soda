#!/bin/bash

usage()
{
    local cmd=$(basename $0)
    cat << EOF
usage: soda-docker <new|run|clean|call> <lang> [options]
EOF
    exit 1
}

self_dir=$(cd $(dirname $0) && pwd)
soda_dir=$(dirname $self_dir)

cmd=$1
ilang=$2

[ -z $ilang ] && usage
image=soda-$ilang

case $cmd in
    new | run | clean | call)
        # DO NOTHING
        ;;
    *)
        usage
        ;;
esac

case $ilang in
    cpp | python)
        docker run --rm -t \
            --user $(id -u):$(id -g) \
            -v "/etc/passwd:/etc/passwd:ro" \
            -v "/etc/group:/etc/group:ro" \
            -v $soda_dir:/soda \
            -v $(pwd):/task \
            -w /task \
            $image /soda/bin/soda "$@"
        ;;
    java)
        docker run --rm -it \
            --network host \
            --user $(id -u):$(id -g) \
            -v "/etc/passwd:/etc/passwd:ro" \
            -v "/etc/group:/etc/group:ro" \
            -v $soda_dir:/soda \
            -v $(pwd):/task \
            -v /home/$USER/.m2:/home/$USER/.m2 \
            -w /task \
            $image /soda/bin/soda "$@"
        ;;
    *)
        echo "language $ilang not supported"
        exit 2
        ;;
esac

