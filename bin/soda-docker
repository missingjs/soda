#!/bin/bash

usage()
{
    local cmd=$(basename $0)
    cat << EOF
usage: soda-docker <new|run|clean|tool> <lang> [options]
EOF
    exit 1
}

self_dir=$(cd $(dirname $0) && pwd)
soda_dir=$(dirname $self_dir)

cmd=$1
ilang=$2

[ -z $ilang ] && usage
image=soda-$ilang

case $cmd in
    new | run | clean | tool)
        # DO NOTHING
        ;;
    *)
        usage
        ;;
esac

case $ilang in
    cpp | python)
        docker run --user $USER --rm -v $soda_dir:/soda -v $(pwd):/task -w /task $image /soda/bin/soda "$@"
        ;;
    java)
        docker run --user $USER --rm \
            -v $soda_dir:/soda \
            -v $(pwd):/task \
            -v /home/$USER/.m2:/home/$USER/.m2 \
            -w /task $image \
            /soda/bin/soda "$@"
        ;;
    *)
        echo "language $ilang not supported"
        exit 2
        ;;
esac

