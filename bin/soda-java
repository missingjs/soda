#!/bin/bash

self_dir=$(cd $(dirname $0) && pwd)
top_dir=$(dirname $self_dir)

lib_dir=$top_dir/lib/soda-java

usage()
{
    cat <<EOF
usage:
    leet-java new <class name>
    leet-java compile <class name>
    leet-java run <class name>
    leet-java go <class name>
EOF
    exit 1
}

create_file()
{
    classname=$1
    [ -z $classname ] && usage
    template=$self_dir/template/Test.java
    srcfile=${classname}.java
    [ -e $srcfile ] && { echo "Error: $srcfile exists" >&2; exit 10; }
    cat $template | sed "s/__Test__/$classname/g" > $srcfile
    echo "$srcfile OK"
}

compile_case()
{
    classname=$1
    [ -z $classname ] && usage
    srcfile=${classname}.java
    javac -cp $classpath $srcfile && echo "Compile OK"
}

run_case()
{
    classname=$1
    [ -z $classname ] && usage
    java -cp $classpath $classname
}

subcmd=$1

classpath=.
for jar in $(ls $lib_dir); do
    classpath="$classpath:$lib_dir/$jar"
done

shift
case $subcmd in
    new)
        create_file "$@"
        ;;
    compile)
        compile_case "$@"
        ;;
    run)
        run_case "$@"
        ;;
    go)
        compile_case "$@" && run_case "$@"
        ;;
    *)
        usage
        ;;
esac
