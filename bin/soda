#!/bin/bash

self_dir=$(cd $(dirname $0) && pwd)
top_dir=$(dirname $self_dir)
framework_dir=$top_dir/framework

usage()
{
    cat << EOF
usage:
    $(basename $0) <lang> [options]

lang: 
    python, cpp, java

python options:
    new <srcfile>                 create source file
    run <srcfile> <datafile>...   run test case
EOF
    exit 1
}

handle_python()
{
    cmd=$1
    [ -z $cmd ] && usage
    shift
    case $cmd in
        new)
            srcfile=$1
            [ -z $srcfile ] && usage
            [ -e $srcfile ] && { echo "Error: $srcfile exists" >&2; exit 2; }
            cat $framework_dir/python/bootstrap.py > $srcfile && echo "$srcfile OK"
            ;;
        run)
            export SODA_PYTHON_DIR=$framework_dir/python
            export PYTHONPATH="$SODA_PYTHON_DIR/src:$PYTHONPATH"
            runner=soda.unittest.tester
            python3 -m $runner "$@"
            ;;
        *)
            usage
            ;;
    esac
}

language=$1
[ -z $language ] && usage

shift

case $language in
    python)
        handle_python "$@"
        ;;
    *)
        usage
        ;;
esac

